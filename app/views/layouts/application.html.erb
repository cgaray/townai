<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Townai" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Townai">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%# Google Fonts - Inter for bold, modern typography %>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="min-h-screen bg-base-100 accent-bar-top">
    <div class="drawer lg:drawer-open">
      <input id="sidebar-drawer" type="checkbox" class="drawer-toggle" />

      <%# Main content area %>
      <div class="drawer-content flex flex-col">
        <%# Navbar with gradient accent %>
        <nav class="navbar bg-base-100 border-b border-base-300 sticky top-0 z-30 shadow-sm">
          <div class="flex-none lg:hidden">
            <label for="sidebar-drawer" class="btn btn-square btn-ghost">
              <%= icon("bars-3", size: "w-6 h-6") %>
            </label>
          </div>
          <div class="flex-1">
            <%= link_to root_path, class: "flex items-center gap-2 hover:opacity-80 transition-opacity" do %>
              <span class="icon-circle icon-circle-sm icon-circle-brand">
                <%= icon("building-library", size: "w-4 h-4") %>
              </span>
              <span class="text-xl font-extrabold tracking-tight text-gradient-primary">TownAI</span>
            <% end %>
          </div>
          <div class="flex-none gap-2">
            <div class="text-sm font-medium text-base-content/60 hidden sm:block">
              Town Meeting Document Manager
            </div>
          </div>
        </nav>

        <%# Page content %>
        <main class="flex-1 p-4 md:p-6 lg:p-8">
          <div class="max-w-6xl mx-auto animate-slide-up">
            <%= yield %>
          </div>
        </main>
      </div>

      <%# Sidebar %>
      <aside class="drawer-side z-40">
        <label for="sidebar-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        <div class="sidebar-gradient min-h-full w-64 p-4 border-r border-base-300">
          <%# Sidebar header with brand %>
          <div class="flex items-center gap-3 px-2 py-4 mb-6">
            <span class="icon-circle icon-circle-lg icon-circle-brand shadow-md">
              <%= icon("building-library", size: "w-6 h-6") %>
            </span>
            <div>
              <div class="font-extrabold text-lg tracking-tight text-gradient-primary">TownAI</div>
              <div class="text-xs text-base-content/50">Town Meeting Manager</div>
            </div>
          </div>

          <%# Navigation section %>
          <div class="mb-6">
            <div class="text-xs font-semibold text-base-content/40 uppercase tracking-wider px-3 mb-2">
              Navigation
            </div>
            <ul class="space-y-1">
              <li>
                <%= link_to documents_path, class: "flex items-center gap-3 px-3 py-2.5 rounded-lg menu-item-hover font-medium #{request.path == documents_path ? 'bg-primary/10 text-primary' : 'text-base-content/70 hover:text-base-content'}" do %>
                  <%= icon("document-text", size: "w-5 h-5") %>
                  <span>All Documents</span>
                  <span class="ml-auto badge badge-sm badge-ghost"><%= Document.count rescue 0 %></span>
                <% end %>
              </li>
              <li>
                <%= link_to attendees_path, class: "flex items-center gap-3 px-3 py-2.5 rounded-lg menu-item-hover font-medium #{request.path.start_with?('/attendees') ? 'bg-primary/10 text-primary' : 'text-base-content/70 hover:text-base-content'}" do %>
                  <%= icon("users", size: "w-5 h-5") %>
                  <span>Attendees</span>
                  <span class="ml-auto badge badge-sm badge-ghost"><%= Attendee.active.count rescue 0 %></span>
                <% end %>
              </li>
            </ul>
          </div>

          <%# Quick stats section %>
          <div class="mb-6">
            <div class="text-xs font-semibold text-base-content/40 uppercase tracking-wider px-3 mb-2">
              Quick Stats
            </div>
            <div class="space-y-2 px-3">
              <div class="stat-card flex items-center justify-between">
                <span class="text-sm text-base-content/60">Complete</span>
                <span class="font-semibold text-success"><%= Document.complete.count rescue 0 %></span>
              </div>
              <div class="stat-card flex items-center justify-between">
                <span class="text-sm text-base-content/60">Processing</span>
                <span class="font-semibold text-warning"><%= Document.where.not(status: [:complete, :failed, :pending]).count rescue 0 %></span>
              </div>
            </div>
          </div>

          <%# Sidebar footer %>
          <div class="absolute bottom-4 left-4 right-4">
            <div class="text-xs text-base-content/40 text-center font-medium">
              v1.0.0
            </div>
          </div>
        </div>
      </aside>
    </div>
  </body>
</html>
