<%# Timeline item for person: combined meeting with documents and topics %>
<% documents = item[:documents] || [] %>
<% extras = item[:extras] || {} %>
<% topics = item[:topics] || [] %>
<% governing_body = item[:governing_body] %>

<%# Get role/status from the first document's extra data (should be same for all docs in meeting) %>
<% first_extra = extras.values.first || {} %>

<div class="w-full">
  <%# Meeting Header Row %>
  <div class="flex flex-wrap items-center gap-2 py-1 px-2">
    <%# Document Type Badges (each links to its document) %>
    <% documents.each do |doc| %>
      <% doc_type = doc.metadata_field("document_type")&.downcase %>
      <%= link_to town_document_path(current_town, doc), class: "hover:shadow-md transition-shadow" do %>
        <%= document_type_badge(doc_type) %>
      <% end %>
    <% end %>
    
    <%# Governing Body %>
    <span class="text-sm text-base-content/60"><%= governing_body %></span>
    
    <%# Role Badge %>
    <% if first_extra[:role] %>
      <%= role_badge(first_extra[:role]) %>
    <% end %>
    
    <%# Status Badge %>
    <% if first_extra[:status] %>
      <span class="badge badge-sm <%= first_extra[:status] == 'present' ? 'badge-success' : first_extra[:status] == 'remote' ? 'badge-info' : 'badge-warning' %> badge-outline">
        <%= first_extra[:status].capitalize %>
      </span>
    <% end %>
  </div>

  <%# Topics List %>
  <% if topics.any? %>
    <div class="mt-2 ml-2 pl-3 border-l-2 border-base-300 space-y-1">
      <% topics.each do |topic_data| %>
        <% topic = topic_data[:topic] %>
        <% topic_doc = topic_data[:document] %>
        <%= link_to town_document_path(current_town, topic_doc, anchor: "topic-#{topic.id}"),
                    class: "flex items-center gap-2 py-0.5 text-sm hover:text-primary transition-colors group/topic" do %>
          <span class="text-base-content/40 group-hover/topic:text-primary/60">â€¢</span>
          <span class="text-base-content/70 group-hover/topic:text-base-content truncate"><%= topic.title %></span>
          <% if topic.has_action? %>
            <%= action_badge(topic.action_taken) %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>
